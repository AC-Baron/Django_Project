{% extends "base.html" %}
{% load static %}
{% block content %}

<h1 class="page-title">My Cookbook â¤ï¸</h1>

<div class="create-btn-container">
  <a href="{% url 'create_recipe' %}" class="create-recipe-btn">+ Create New Recipe</a>
</div>

<!-- ğŸ” Global Search Bar -->
<div class="search-container">
  <input 
    type="text" 
    id="cookbook-search" 
    placeholder="Search Recipes/Favourites..." 
    class="search-input"
  >
</div>

<!-- ============================
    MY RECIPES
============================= -->
<div class="collapsible">
  <button class="collapse-btn" type="button" data-target="#my-recipes">My Recipes â–¼</button>

  <div id="my-recipes" class="collapsible-content">

    {% if not user.is_authenticated %}
      <p>You must be logged in to use this feature.</p>

    {% elif my_recipes %}
      <div id="my-recipes-grid" class="recipe-card-grid">

        {% for recipe in my_recipes %}
        <div class="recipe-card-wrapper">

          <div 
            class="recipe-card"
            data-title="{{ recipe.title|lower }}"
            data-ingredients="{% for ing in recipe.ingredients.all %}{{ ing.name|lower }} {% endfor %}"
          >

            <!-- Image -->
            <div class="recipe-image-container">
              {% if recipe.image %}
                <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}" class="recipe-image">
              {% else %}
                <img src="{% static 'images/default_recipe.png' %}" alt="Default image" class="recipe-image">
              {% endif %}
            </div>

            <!-- Title -->
            <div class="recipe-info">
              <h3 class="recipe-title">
                <a href="{% url 'recipe_detail' recipe.pk %}">{{ recipe.title }}</a>
              </h3>
            </div>

            <!-- EDIT BUTTON (owner OR admin) -->
            {% if request.user == recipe.author or request.user.is_staff or request.user.is_superuser %}
              <a href="{% url 'edit_recipe' recipe.pk %}" class="edit-link">âœï¸</a>
            {% endif %}

          </div>
        </div>
        {% endfor %}

      </div>

    {% else %}
      <p>You havenâ€™t created any recipes yet.</p>
    {% endif %}

  </div>
</div>


<!-- ============================
    FAVOURITES
============================= -->
<div class="collapsible">
  <button class="collapse-btn" type="button" data-target="#favorite-recipes">My Favourites â–¼</button>

  <div id="favorite-recipes" class="collapsible-content">

    {% if not user.is_authenticated %}
      <p>You must be logged in to use this feature.</p>

    {% elif favorite_recipes %}
      <div id="favourite-recipes-grid" class="recipe-card-grid">

        {% for recipe in favorite_recipes %}
        <div class="recipe-card-wrapper">

          <div 
            class="recipe-card"
            data-title="{{ recipe.title|lower }}"
            data-ingredients="{% for ing in recipe.ingredients.all %}{{ ing.name|lower }} {% endfor %}"
          >

            <!-- Image -->
            <div class="recipe-image-container">
              {% if recipe.image %}
                <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}" class="recipe-image">
              {% else %}
                <img src="{% static 'images/default_recipe.png' %}" alt="Default image" class="recipe-image">
              {% endif %}
            </div>

            <!-- Title -->
            <div class="recipe-info">
              <h3 class="recipe-title">
                <a href="{% url 'recipe_detail' recipe.pk %}">{{ recipe.title }}</a>
              </h3>
            </div>

            <!-- EDIT BUTTON â€” ADMINS ONLY -->
            {% if request.user.is_staff or request.user.is_superuser %}
              <a href="{% url 'edit_recipe' recipe.pk %}" class="edit-link">âœï¸</a>
            {% endif %}

          </div>

          <!-- Author below card -->
          <div class="recipe-author-badge">
            By {{ recipe.author.username }}</p>
          </div>

        </div>
        {% endfor %}

      </div>

    {% else %}
      <p>You havenâ€™t favorited any recipes yet.</p>
    {% endif %}

  </div>
</div>

<link rel="stylesheet" href="{% static 'css/cookbook.css' %}">
<script src="{% static 'js/cookbook.js' %}"></script>

{% endblock %}

